

<div class="card bg-dark text-light shadow-lg">
    <div class="card-body">
        <h4 class="card-title mb-3">Lista de Productos</h4>
        <div class="table-responsive">
            <table class="table table-striped table-dark align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Stock</th>
                        <th>Precio</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="itemsTable">
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="spinner-border text-light" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Cargar productos desde la API
    async function loadItems() {
        try {
            const response = await fetch('/api/items');
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.error);
            }
            
            const tbody = document.getElementById('itemsTable');
            
            if (result.data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">No hay productos registrados</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = result.data.map(item => `
                <tr id="row-${item.id}">
                    <td>${item.id}</td>
                    <td>${item.nombre}</td>
                    <td>${item.stock}</td>
                    <td>$${item.precio.toFixed(2)}</td>
                    <td>
                        <a href="/update/${item.id}" class="btn btn-sm btn-primary">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                        <button onclick="deleteItem(${item.id})" class="btn btn-sm btn-danger">
                            <i class="bi bi-trash"></i> Eliminar
                        </button>
                    </td>
                </tr>
            `).join('');
            
        } catch (error) {
            console.error('Error al cargar productos:', error);
            document.getElementById('itemsTable').innerHTML = `
                <tr>
                    <td colspan="5" class="text-center text-danger">
                        Error al cargar productos: ${error.message}
                    </td>
                </tr>
            `;
        }
    }

    // Eliminar producto
    async function deleteItem(id) {
        if (!confirm('¿Estás seguro de eliminar este producto?')) {
            return;
        }
        
        try {
            const response = await fetch(`/api/items/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                showFlash(result.message, 'success');
                // Eliminar fila con animación
                const row = document.getElementById(`row-${id}`);
                row.style.transition = 'opacity 0.3s';
                row.style.opacity = '0';
                setTimeout(() => row.remove(), 300);
            } else {
                showFlash(result.error, 'danger');
            }
            
        } catch (error) {
            showFlash('Error al eliminar producto: ' + error.message, 'danger');
        }
    }

    // Cargar productos al iniciar la página
    document.addEventListener('DOMContentLoaded', loadItems);
</script>
